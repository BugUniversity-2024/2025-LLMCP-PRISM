# PRISM 项目对话式编程记录

> 本文档记录了 PRISM 项目开发过程中的对话式编程交互历史。
>
> **参与者**：
> - **AptS:1547** - 项目负责人/用户
> - **AptS:1548** - AI 编程助手 (Claude Code)

---

## 阶段 1: 需求讨论与项目规划

### 1.1 项目定位讨论

**AptS:1547**:
> 1548 看看我们这个项目的一个计划文件，你觉得如何，我们主要是做功能设计 + 功能分析 + 拆解还有技术栈选型。我们一起热烈讨论一下，不要着急出方案

**AptS:1547**:
> 主要是现在的模型比如 seedream 还有 gemini，他也是支持自然语言绘图的（也就是说，你可以给一张图片上去，然后说 "请帮我调亮这个图片"），我们的定位就是在用户和 gemini（或者别的）做一个中间层，在中间层使用如 GPT-4o 等模型去优化提示词。我们会给一个固定的提示词模版当作 RAG

**AptS:1547**:
> 比如的固定提示词，我把我的对话放到一个新的文件吧，是我和 gpt 的对话。等我一下

**AptS:1547**:
> 你应该能分清楚谁是谁吧

**AptS:1547**:
> System Prompt 把图A传给 SeeDream 原方案还需要。我们就可能做的是 PAAS，我们能够提供平台内绘画功能。核心痛点，比如我写提示词有时候都写不到我想要的效果，但是 GPT 或者其他优化是可以做到的

### 1.2 项目初始化

**AptS:1547**:
> 暂时请你先写出来项目方案，写代码的事情我得等一会

**AptS:1547**:
> 我觉得可以，先帮我 init 一下吧，只要 init 就行了。所有的包增加都要使用包管理器，前端使用 pnpm 或者 bun，你来决定。后端 python 使用 uv。先暂时做这些

**AptS:1547**:
> 要不前端我自己来

**AptS:1547**:
> 前端我 init 好了，你看看

### 1.3 前端技术选型

**AptS:1547**:
> 你来吧，用 tailwindcss 还有 shadcn，我觉得比较好

**AptS:1547**:
> 注意 tailwindcss 是 v4 版本

**AptS:1547**:
> 请你按照前端规范开始创建吧，后端可以暂时使用 mock，前端不允许 mock

---

## 阶段 2: 前端开发与 UI 迭代

### 2.1 样式问题排查

**AptS:1547**:
> [附带截图] 目前的页面样式很有问题，感觉就和三大件一样。探索是什么问题导致的，然后再修复

**AptS:1547**:
> 前端用 svg 的部分能否换成 heroicon

**AptS:1547**:
> 前端服务器在我这边启动了，我把你的给 kill 掉了，现在没问题

### 2.2 API 文档编写

**AptS:1547**:
> 然后现在需要你提供一下前后端 api 的技术文档，放在 docs 下面

---

## 阶段 3: UI 优化与视觉升级

### 3.1 UI 改进需求

**AptS:1547**:
> 然后目前我们的前端有点丑陋，没能很好的体现一个应用程序 prompt 优化工具的感觉，有什么方案吗，而且很杂乱

**AptS:1547**:
> 1548 看看我们的 UI，我感觉很丑而且不好看，你有什么想法

**AptS:1547**:
> 提升视觉层次 动画和交互 细节优化 更好的布局

**AptS:1547**:
> 请你设计吧

### 3.2 设计完成确认

**AptS:1547**:
> 我感觉十分不错的啊～很棒！然后看看我们的 docs，目前我们都只是一个 mock 后段。如果要完全实现我们这个项目的话，能否请你先调查一下

---

## 阶段 4: 后端真实 API 集成

### 4.1 数据库选型

**AptS:1547**:
> 我建议不用 postgresql，暂时先使用 sqlite

### 4.2 API 配置

**AptS:1547**:
> 因为我们应该不使用官方的 api，我希望你能够加上一下 API Base 配置，以及更新一下 example 吧

### 4.3 数据持久化问题

**AptS:1547**:
> 然后看一下我们的前后端，似乎存在一个严重的问题，就是我们的之前生成的图片和历史，会被直接刷新后在前端删除。用户看不到之前画了什么图

**AptS:1547**:
> 要不看一下后端能不能传回来？我想的是版本管理和项目的形式。可以开多个项目，每个项目有单独的版本管理

**AptS:1547**:
> 没事，我验证好了，可以使用

### 4.4 UI 逻辑优化

**AptS:1547**:
> 然后有个问题，创意输入应该只在 v1 版本显示吧……？还是都可以显示？

---

## 阶段 5: 前端逻辑完善

### 5.1 输入模式切换

**AptS:1547**:
> 主要是目前看一下 创意输入 反馈优化 这一部份，在版本 v1 生成后不应该继续显示 创意输入 了吧? 应该就是进入反馈优化环节。因为我们是分项目管理生成优化的

### 5.2 真实 API 对接

**AptS:1547**:
> 然后再看一下我们后端的设计那一部分。目前是还没有正式对接 api 的，能否看看文档之后帮我实现呢？

### 5.3 API 调试

**AptS:1547**:
> 程序似乎没能够正确调用 api，前端发送到 generate 的是 http://localhost:5173/api/v1/generate {"user_input":"请你帮我画一个二次元狐狸娘，坐在海边的座椅上，背对着镜头，看着远处的日落"} 而且 env 设置好了，看看？

**AptS:1547**:
> {"detail":"内部错误: No module named 'google'"} gemini 也是中转的，要设置成模型选择

### 5.4 用户体验优化

**AptS:1547**:
> 然后我建议前端点生成的时候先让后端返回文字，后让前端确认后开始画图。这样子可以省钱也可以让用户直接二次修改，看看怎么实现

**AptS:1547**:
> 把前端的超时时长设置的长一点吧

---

## 阶段 6: 图片生成 API 集成

### 6.1 API 格式探索

**AptS:1547**:
> 1548 看一看我们这个项目，特别是后端生成图片的部分，目前我们还没弄懂他的请求和返回格式

**AptS:1547**:
> 换一个模型 gemini-3-pro-image

### 6.2 火山引擎 Seedream 集成

**AptS:1547**:
> 我改了一下，使用这个，然后文档在 https://www.volcengine.com/docs/82379/1824121?lang=zh 你可以用 google mcp 看看

**AptS:1547**:
> curl -X POST https://ark.cn-beijing.volces.com/api/v3/images/generations \
>   -H "Content-Type: application/json" \
>   -H "Authorization: Bearer xxx" \
>   -d '{
>     "model": "doubao-seedream-4-0-250828",
>     "prompt": "星际穿越，黑洞...",
>     ...
> }' 他的发送方式，看看有无其他地方出问题？

**AptS:1547**:
> 等一下，其实可以用 openai sdk
> ```python
> from openai import OpenAI
> client = OpenAI(
>     base_url="https://ark.cn-beijing.volces.com/api/v3",
>     api_key=os.environ.get("ARK_API_KEY"),
> )
> imagesResponse = client.images.generate(
>     model="doubao-seedream-4-0-250828",
>     prompt="...",
>     size="2K",
>     response_format="url",
> )
> ```
> 方式类似

**AptS:1547**:
> 然后更新一下吧

### 6.3 Prompt 优化

**AptS:1547**:
> 然后你看眼目前我们 prompt 生成的部分和火山推荐的 prompt 风格，看看能不能优化一下 prompt 的一些生成逻辑？

---

## 阶段 7: 项目完成与 Bug 修复

### 7.1 项目成功

**AptS:1547**:
> 我艹！谢谢你 48！这个项目完全成功了！

### 7.2 反馈功能 Bug 修复

**AptS:1547**:
> 调查一下一个 bug INFO: 127.0.0.1:56082 - "POST /api/v1/feedback HTTP/1.1" 422 Unprocessable Entity 前端返回的是 {"version":2,"feedback":"AI 味道有点重，请你优化一下，主要是脸部用的色彩太诡异了"}

**AptS:1547**:
> 你能否更新一下前端呢

**AptS:1547**:
> 前端是这样的 Request URL http://localhost:5173/api/v1/sessions/undefined/feedback 看看是不是没能获取到 ID，是反馈优化那部分

---

## 总结

本次对话式编程过程涵盖了 PRISM 项目的完整开发周期：

1. **需求讨论** - 明确项目定位为 Prompt 优化中间层
2. **技术选型** - Vue 3 + Tailwind CSS v4 + FastAPI + SQLite
3. **前端开发** - 使用 shadcn-vue 构建现代化 UI
4. **UI 迭代** - 多轮优化提升视觉体验
5. **后端集成** - 从 Mock 模式迁移到真实 API
6. **API 对接** - 集成火山引擎 Seedream 图片生成
7. **Bug 修复** - 解决前后端交互问题

整个开发过程充分体现了**对话式编程**的协作模式，通过自然语言交流实现需求沟通、技术决策和代码实现。
